var Pixastic=function(){function t(t,a,e){t.addEventListener?t.addEventListener(a,e,!1):t.attachEvent&&t.attachEvent("on"+a,e)}function a(a){var e=!1,i=function(){e||(e=!0,a())};document.write('<script defer src="//:" id="__onload_ie_pixastic__"></script>');var r=document.getElementById("__onload_ie_pixastic__");r.onreadystatechange=function(){"complete"==r.readyState&&(r.parentNode.removeChild(r),i())},document.addEventListener&&document.addEventListener("DOMContentLoaded",i,!1),t(window,"load",i)}function e(){for(var t=r("pixastic",null,"img"),a=r("pixastic",null,"canvas"),e=t.concat(a),i=0;i<e.length;i++)!function(){for(var t=e[i],a=[],r=t.className.split(" "),n=0;n<r.length;n++){var s=r[n];if("pixastic-"==s.substring(0,9)){var o=s.substring(9);""!=o&&a.push(o)}}if(a.length)if("img"==t.tagName.toLowerCase()){var c=new Image;if(c.src=t.src,c.complete)for(var h=0;h<a.length;h++){var l=Pixastic.applyAction(t,t,a[h],null);l&&(t=l)}else c.onload=function(){for(var e=0;e<a.length;e++){var i=Pixastic.applyAction(t,t,a[e],null);i&&(t=i)}}}else setTimeout(function(){for(var e=0;e<a.length;e++){var i=Pixastic.applyAction(t,t,a[e],null);i&&(t=i)}},1)}()}function r(t,a,e){var r=new Array;null==a&&(a=document),null==e&&(e="*");var n=a.getElementsByTagName(e),s=n.length,o=new RegExp("(^|\\s)"+t+"(\\s|$)");for(i=0,j=0;i<s;i++)o.test(n[i].className)&&(r[j]=n[i],j++);return r}function n(t,a){if(Pixastic.debug)try{switch(a){case"warn":console.warn("Pixastic:",t);break;case"error":console.error("Pixastic:",t);break;default:console.log("Pixastic:",t)}}catch(e){}}"undefined"!=typeof pixastic_parseonload&&pixastic_parseonload&&a(e);var s=function(){var t=document.createElement("canvas"),a=!1;try{a=!("function"!=typeof t.getContext||!t.getContext("2d"))}catch(e){}return function(){return a}}(),o=function(){var t,a=document.createElement("canvas"),e=!1;try{"function"==typeof a.getContext&&(t=a.getContext("2d"))&&(e="function"==typeof t.getImageData)}catch(i){}return function(){return e}}(),c=function(){var t=!1,a=document.createElement("canvas");if(s()&&o()){a.width=a.height=1;var e=a.getContext("2d");e.fillStyle="rgb(255,0,0)",e.fillRect(0,0,1,1);var i=document.createElement("canvas");i.width=i.height=1;var r=i.getContext("2d");r.fillStyle="rgb(0,0,255)",r.fillRect(0,0,1,1),e.globalAlpha=.5,e.drawImage(i,0,0);var n=e.getImageData(0,0,1,1).data;t=255!=n[2]}return function(){return t}}();return{parseOnLoad:!1,debug:!1,applyAction:function(t,a,e,i){i=i||{};var r="canvas"==t.tagName.toLowerCase();if(r&&Pixastic.Client.isIE())return Pixastic.debug&&n("Tried to process a canvas element but browser is IE."),!1;var s,o,c=!1;Pixastic.Client.hasCanvas()&&(c=!!i.resultCanvas,s=i.resultCanvas||document.createElement("canvas"),o=s.getContext("2d"));var h=t.offsetWidth,l=t.offsetHeight;if(r&&(h=t.width,l=t.height),0==h||0==l){if(null!=t.parentNode)return void(Pixastic.debug&&n("Image has 0 width and/or height."));var p=t.style.position,g=t.style.left;t.style.position="absolute",t.style.left="-9999px",document.body.appendChild(t),h=t.offsetWidth,l=t.offsetHeight,document.body.removeChild(t),t.style.position=p,t.style.left=g}if(e.indexOf("(")>-1){var v=e;e=v.substr(0,v.indexOf("("));var d=v.match(/\((.*?)\)/);if(d[1]){d=d[1].split(";");for(var u=0;u<d.length;u++)if(thisArg=d[u].split("="),2==thisArg.length)if("rect"==thisArg[0]){var f=thisArg[1].split(",");i[thisArg[0]]={left:parseInt(f[0],10)||0,top:parseInt(f[1],10)||0,width:parseInt(f[2],10)||0,height:parseInt(f[3],10)||0}}else i[thisArg[0]]=thisArg[1]}}i.rect?(i.rect.left=Math.round(i.rect.left),i.rect.top=Math.round(i.rect.top),i.rect.width=Math.round(i.rect.width),i.rect.height=Math.round(i.rect.height)):i.rect={left:0,top:0,width:h,height:l};var m=!1;if(Pixastic.Actions[e]&&"function"==typeof Pixastic.Actions[e].process&&(m=!0),!m)return Pixastic.debug&&n('Invalid action "'+e+'". Maybe file not included?'),!1;if(!Pixastic.Actions[e].checkSupport())return Pixastic.debug&&n('Action "'+e+'" not supported by this browser.'),!1;Pixastic.Client.hasCanvas()?(s!==t&&(s.width=h,s.height=l),c||(s.style.width=h+"px",s.style.height=l+"px"),o.drawImage(a,0,0,h,l),t.__pixastic_org_image?(s.__pixastic_org_image=t.__pixastic_org_image,s.__pixastic_org_width=t.__pixastic_org_width,s.__pixastic_org_height=t.__pixastic_org_height):(s.__pixastic_org_image=t,s.__pixastic_org_width=h,s.__pixastic_org_height=l)):Pixastic.Client.isIE()&&"undefined"==typeof t.__pixastic_org_style&&(t.__pixastic_org_style=t.style.cssText);var x={image:t,canvas:s,width:h,height:l,useData:!0,options:i},C=Pixastic.Actions[e].process(x);return C?Pixastic.Client.hasCanvas()?(x.useData&&Pixastic.Client.hasCanvasImageData()&&(s.getContext("2d").putImageData(x.canvasData,i.rect.left,i.rect.top),s.getContext("2d").fillRect(0,0,0,0)),i.leaveDOM||(s.title=t.title,s.imgsrc=t.imgsrc,r||(s.alt=t.alt),r||(s.imgsrc=t.src),s.className=t.className,s.style.cssText=t.style.cssText,s.name=t.name,s.tabIndex=t.tabIndex,s.id=t.id,t.parentNode&&t.parentNode.replaceChild&&t.parentNode.replaceChild(s,t)),i.resultCanvas=s,s):t:!1},prepareData:function(t,a){var e=t.canvas.getContext("2d"),i=t.options.rect,r=e.getImageData(i.left,i.top,i.width,i.height),n=r.data;return a||(t.canvasData=r),n},process:function(t,a,e,i){if("img"==t.tagName.toLowerCase()){var r=new Image;if(r.src=t.src,r.complete){var n=Pixastic.applyAction(t,r,a,e);return i&&i(n),n}r.onload=function(){var n=Pixastic.applyAction(t,r,a,e);i&&i(n)}}if("canvas"==t.tagName.toLowerCase()){var n=Pixastic.applyAction(t,t,a,e);return i&&i(n),n}},revert:function(t){if(Pixastic.Client.hasCanvas()){if("canvas"==t.tagName.toLowerCase()&&t.__pixastic_org_image)return t.width=t.__pixastic_org_width,t.height=t.__pixastic_org_height,t.getContext("2d").drawImage(t.__pixastic_org_image,0,0),t.parentNode&&t.parentNode.replaceChild&&t.parentNode.replaceChild(t.__pixastic_org_image,t),t}else Pixastic.Client.isIE()&&"undefined"!=typeof t.__pixastic_org_style&&(t.style.cssText=t.__pixastic_org_style)},Client:{hasCanvas:s,hasCanvasImageData:o,hasGlobalAlpha:c,isIE:function(){return!!document.all&&!!window.attachEvent&&!window.opera}},Actions:{}}}();"undefined"!=typeof jQuery&&jQuery&&jQuery.fn&&(jQuery.fn.pixastic=function(t,a){var e=[];return this.each(function(){if("img"!=this.tagName.toLowerCase()||this.complete){var i=Pixastic.process(this,t,a);i&&e.push(i)}}),e.length>0?jQuery(e):this}),Pixastic.Actions.blend={process:function(t){var a=parseFloat(t.options.amount),e=(t.options.mode||"normal").toLowerCase(),i=t.options.image;if(a=Math.max(0,Math.min(1,a)),!i)return!1;if(Pixastic.Client.hasCanvasImageData()){var r=t.options.rect,n=Pixastic.prepareData(t),s=r.width,o=r.height;t.useData=!1;var c=document.createElement("canvas");c.width=t.canvas.width,c.height=t.canvas.height;var h=c.getContext("2d");h.drawImage(i,0,0);var l,p,g,v,d,u,f,m,x,C,w,P,I,D,y={canvas:c,options:t.options},M=Pixastic.prepareData(y),b=y.canvasData,_=s*o,k=4*_,A=!1;switch(e){case"normal":break;case"multiply":for(;_--;)M[k-=4]=n[k]*M[k]/255,M[l=k+1]=n[l]*M[l]/255,M[p=k+2]=n[p]*M[p]/255;A=!0;break;case"lighten":for(;_--;)(g=n[k-=4])>M[k]&&(M[k]=g),(v=n[l=k+1])>M[l]&&(M[l]=v),(d=n[p=k+2])>M[p]&&(M[p]=d);A=!0;break;case"darken":for(;_--;)(g=n[k-=4])<M[k]&&(M[k]=g),(v=n[l=k+1])<M[l]&&(M[l]=v),(d=n[p=k+2])<M[p]&&(M[p]=d);A=!0;break;case"darkercolor":for(;_--;).3*(g=n[k-=4])+.59*(v=n[l=k+1])+.11*(d=n[p=k+2])<=.3*M[k]+.59*M[l]+.11*M[p]&&(M[k]=g,M[l]=v,M[p]=d);A=!0;break;case"lightercolor":for(;_--;).3*(g=n[k-=4])+.59*(v=n[l=k+1])+.11*(d=n[p=k+2])>.3*M[k]+.59*M[l]+.11*M[p]&&(M[k]=g,M[l]=v,M[p]=d);A=!0;break;case"lineardodge":for(;_--;)(x=n[k-=4]+M[k])>255?M[k]=255:M[k]=x,(C=n[l=k+1]+M[l])>255?M[l]=255:M[l]=C,(w=n[p=k+2]+M[p])>255?M[p]=255:M[p]=w;A=!0;break;case"linearburn":for(;_--;)(x=n[k-=4]+M[k])<255?M[k]=0:M[k]=x-255,(C=n[l=k+1]+M[l])<255?M[l]=0:M[l]=C-255,(w=n[p=k+2]+M[p])<255?M[p]=0:M[p]=w-255;A=!0;break;case"difference":for(;_--;)(x=n[k-=4]-M[k])<0?M[k]=-x:M[k]=x,(C=n[l=k+1]-M[l])<0?M[l]=-C:M[l]=C,(w=n[p=k+2]-M[p])<0?M[p]=-w:M[p]=w;A=!0;break;case"screen":for(;_--;)M[k-=4]=255-((255-M[k])*(255-n[k])>>8),M[l=k+1]=255-((255-M[l])*(255-n[l])>>8),M[p=k+2]=255-((255-M[p])*(255-n[p])>>8);A=!0;break;case"exclusion":for(var E=2/255;_--;)M[k-=4]=(g=n[k])-(g*E-1)*M[k],M[l=k+1]=(v=n[l])-(v*E-1)*M[l],M[p=k+2]=(d=n[p])-(d*E-1)*M[p];A=!0;break;case"overlay":for(var E=2/255;_--;)(g=n[k-=4])<128?M[k]=M[k]*g*E:M[k]=255-(255-M[k])*(255-g)*E,(v=n[l=k+1])<128?M[l]=M[l]*v*E:M[l]=255-(255-M[l])*(255-v)*E,(d=n[p=k+2])<128?M[p]=M[p]*d*E:M[p]=255-(255-M[p])*(255-d)*E;A=!0;break;case"softlight":for(var E=2/255;_--;)(g=n[k-=4])<128?M[k]=((M[k]>>1)+64)*g*E:M[k]=255-(191-(M[k]>>1))*(255-g)*E,(v=n[l=k+1])<128?M[l]=((M[l]>>1)+64)*v*E:M[l]=255-(191-(M[l]>>1))*(255-v)*E,(d=n[p=k+2])<128?M[p]=((M[p]>>1)+64)*d*E:M[p]=255-(191-(M[p]>>1))*(255-d)*E;A=!0;break;case"hardlight":for(var E=2/255;_--;)(u=M[k-=4])<128?M[k]=n[k]*u*E:M[k]=255-(255-n[k])*(255-u)*E,(f=M[l=k+1])<128?M[l]=n[l]*f*E:M[l]=255-(255-n[l])*(255-f)*E,(m=M[p=k+2])<128?M[p]=n[p]*m*E:M[p]=255-(255-n[p])*(255-m)*E;A=!0;break;case"colordodge":for(;_--;)(x=(n[k-=4]<<8)/(255-(u=M[k])))>255||255==u?M[k]=255:M[k]=x,(C=(n[l=k+1]<<8)/(255-(f=M[l])))>255||255==f?M[l]=255:M[l]=C,(w=(n[p=k+2]<<8)/(255-(m=M[p])))>255||255==m?M[p]=255:M[p]=w;A=!0;break;case"colorburn":for(;_--;)(x=255-(255-n[k-=4]<<8)/M[k])<0||0==M[k]?M[k]=0:M[k]=x,(C=255-(255-n[l=k+1]<<8)/M[l])<0||0==M[l]?M[l]=0:M[l]=C,(w=255-(255-n[p=k+2]<<8)/M[p])<0||0==M[p]?M[p]=0:M[p]=w;A=!0;break;case"linearlight":for(;_--;)(x=2*(u=M[k-=4])+n[k]-256)<0||128>u&&0>x?M[k]=0:x>255?M[k]=255:M[k]=x,(C=2*(f=M[l=k+1])+n[l]-256)<0||128>f&&0>C?M[l]=0:C>255?M[l]=255:M[l]=C,(w=2*(m=M[p=k+2])+n[p]-256)<0||128>m&&0>w?M[p]=0:w>255?M[p]=255:M[p]=w;A=!0;break;case"vividlight":for(;_--;)(u=M[k-=4])<128?u?(x=255-(255-n[k]<<8)/(2*u))<0?M[k]=0:M[k]=x:M[k]=0:(x=P=2*u-256)<255?(x=(n[k]<<8)/(255-P))>255?M[k]=255:M[k]=x:0>x?M[k]=0:M[k]=x,(f=M[l=k+1])<128?f?(C=255-(255-n[l]<<8)/(2*f))<0?M[l]=0:M[l]=C:M[l]=0:(C=I=2*f-256)<255?(C=(n[l]<<8)/(255-I))>255?M[l]=255:M[l]=C:0>C?M[l]=0:M[l]=C,(m=M[p=k+2])<128?m?(w=255-(255-n[p]<<8)/(2*m))<0?M[p]=0:M[p]=w:M[p]=0:(w=D=2*m-256)<255?(w=(n[p]<<8)/(255-D))>255?M[p]=255:M[p]=w:0>w?M[p]=0:M[p]=w;A=!0;break;case"pinlight":for(;_--;)(u=M[k-=4])<128?(g=n[k])<(P=2*u)?M[k]=g:M[k]=P:(g=n[k])>(P=2*u-256)?M[k]=g:M[k]=P,(f=M[l=k+1])<128?(v=n[l])<(I=2*f)?M[l]=v:M[l]=I:(v=n[l])>(I=2*f-256)?M[l]=v:M[l]=I,(u=M[p=k+2])<128?(g=n[p])<(P=2*u)?M[p]=g:M[p]=P:(g=n[p])>(P=2*u-256)?M[p]=g:M[p]=P;A=!0;break;case"hardmix":for(;_--;)(u=M[k-=4])<128?255-(255-n[k]<<8)/(2*u)<128||0==u?M[k]=0:M[k]=255:(P=2*u-256)<255&&(n[k]<<8)/(255-P)<128?M[k]=0:M[k]=255,(f=M[l=k+1])<128?255-(255-n[l]<<8)/(2*f)<128||0==f?M[l]=0:M[l]=255:(I=2*f-256)<255&&(n[l]<<8)/(255-I)<128?M[l]=0:M[l]=255,(m=M[p=k+2])<128?255-(255-n[p]<<8)/(2*m)<128||0==m?M[p]=0:M[p]=255:(D=2*m-256)<255&&(n[p]<<8)/(255-D)<128?M[p]=0:M[p]=255;A=!0}if(A&&h.putImageData(b,0,0),1==a||Pixastic.Client.hasGlobalAlpha()){var S=t.canvas.getContext("2d");S.save(),S.globalAlpha=a,S.drawImage(c,0,0,r.width,r.height,r.left,r.top,r.width,r.height),S.globalAlpha=1,S.restore()}else{for(var _=s*o,F=a,L=1-a;_--;){var k=4*_,N=n[k]*L+M[k]*F>>0,R=n[k+1]*L+M[k+1]*F>>0,T=n[k+2]*L+M[k+2]*F>>0;n[k]=N,n[k+1]=R,n[k+2]=T}t.useData=!0}return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}},Pixastic.Actions.blur={process:function(t){if("undefined"==typeof t.options.fixMargin&&(t.options.fixMargin=!0),Pixastic.Client.hasCanvasImageData()){for(var a=Pixastic.prepareData(t),e=Pixastic.prepareData(t,!0),i=[[0,1,0],[1,2,1],[0,1,0]],r=0,n=0;3>n;n++)for(var s=0;3>s;s++)r+=i[n][s];r=1/(2*r);var o=t.options.rect,c=o.width,h=o.height,l=4*c,p=h;do{var g=(p-1)*l,v=1==p?0:p-2,d=p==h?p-1:p,u=v*c*4,f=d*c*4,m=c;do{var x=g+(4*m-4),C=u+4*(1==m?0:m-2),w=f+4*(m==c?m-1:m);a[x]=(2*(e[C]+e[x-4]+e[x+4]+e[w])+4*e[x])*r,a[x+1]=(2*(e[C+1]+e[x-3]+e[x+5]+e[w+1])+4*e[x+1])*r,a[x+2]=(2*(e[C+2]+e[x-2]+e[x+6]+e[w+2])+4*e[x+2])*r}while(--m)}while(--p);return!0}return Pixastic.Client.isIE()?(t.image.style.filter+=" progid:DXImageTransform.Microsoft.Blur(pixelradius=1.5)",t.options.fixMargin&&(t.image.style.marginLeft=(parseInt(t.image.style.marginLeft,10)||0)-2+"px",t.image.style.marginTop=(parseInt(t.image.style.marginTop,10)||0)-2+"px"),!0):void 0},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()||Pixastic.Client.isIE()}},Pixastic.Actions.blurfast={process:function(t){var a=parseFloat(t.options.amount)||0,e=!(!t.options.clear||"false"==t.options.clear);if(a=Math.max(0,Math.min(5,a)),Pixastic.Client.hasCanvas()){var i=t.options.rect,r=t.canvas.getContext("2d");r.save(),r.beginPath(),r.rect(i.left,i.top,i.width,i.height),r.clip();var n=2,s=Math.round(t.width/n),o=Math.round(t.height/n),c=document.createElement("canvas");c.width=s,c.height=o;for(var e=!1,h=Math.round(20*a),l=c.getContext("2d"),p=0;h>p;p++){var g=Math.max(1,Math.round(s-p)),v=Math.max(1,Math.round(o-p));l.clearRect(0,0,s,o),l.drawImage(t.canvas,0,0,t.width,t.height,0,0,g,v),e&&r.clearRect(i.left,i.top,i.width,i.height),r.drawImage(c,0,0,g,v,0,0,t.width,t.height)}return r.restore(),t.useData=!1,!0}if(Pixastic.Client.isIE()){var d=10*a;return t.image.style.filter+=" progid:DXImageTransform.Microsoft.Blur(pixelradius="+d+")",t.options.fixMargin,t.image.style.marginLeft=(parseInt(t.image.style.marginLeft,10)||0)-Math.round(d)+"px",t.image.style.marginTop=(parseInt(t.image.style.marginTop,10)||0)-Math.round(d)+"px",!0}},checkSupport:function(){return Pixastic.Client.hasCanvas()||Pixastic.Client.isIE()}},Pixastic.Actions.brightness={process:function(t){var a=parseInt(t.options.brightness,10)||0,e=parseFloat(t.options.contrast)||0,i=!(!t.options.legacy||"false"==t.options.legacy);if(i)a=Math.min(150,Math.max(-150,a));else var r=1+Math.min(150,Math.max(-150,a))/150;if(e=Math.max(0,e+1),Pixastic.Client.hasCanvasImageData()){var n,s,o,c,h=Pixastic.prepareData(t),l=t.options.rect,p=l.width,g=l.height,v=p*g,d=4*v;1!=e?i?(o=e,c=(a-128)*e+128):(o=r*e,c=128*-e+128):i?(o=1,c=a):(o=r,c=0);for(var u,f,m;v--;)(u=h[d-=4]*o+c)>255?h[d]=255:0>u?h[d]=0:h[d]=u,(f=h[n=d+1]*o+c)>255?h[n]=255:0>f?h[n]=0:h[n]=f,(m=h[s=d+2]*o+c)>255?h[s]=255:0>m?h[s]=0:h[s]=m;return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}},Pixastic.Actions.coloradjust={process:function(t){var a=parseFloat(t.options.red)||0,e=parseFloat(t.options.green)||0,i=parseFloat(t.options.blue)||0;if(a=Math.round(255*a),e=Math.round(255*e),i=Math.round(255*i),Pixastic.Client.hasCanvasImageData()){for(var r,n,s,o,c,h=Pixastic.prepareData(t),l=t.options.rect,p=l.width*l.height,g=4*p;p--;)g-=4,a&&((s=h[g]+a)<0?h[g]=0:s>255?h[g]=255:h[g]=s),e&&((o=h[r=g+1]+e)<0?h[r]=0:o>255?h[r]=255:h[r]=o),i&&((c=h[n=g+2]+i)<0?h[n]=0:c>255?h[n]=255:h[n]=c);return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}},Pixastic.Actions.colorhistogram={array256:function(t){arr=[];for(var a=0;256>a;a++)arr[a]=t;return arr},process:function(t){"object"!=typeof t.options.returnValue&&(t.options.returnValue={rvals:[],gvals:[],bvals:[]});var a=!!t.options.paint,e=t.options.returnValue;if("array"!=typeof e.values&&(e.rvals=[],e.gvals=[],e.bvals=[]),Pixastic.Client.hasCanvasImageData()){var i=Pixastic.prepareData(t);t.useData=!1;for(var r=this.array256(0),n=this.array256(0),s=this.array256(0),o=t.options.rect,c=o.width*o.height,h=4*c;c--;)r[i[h-=4]]++,n[i[h+1]]++,s[i[h+2]]++;if(e.rvals=r,e.gvals=n,e.bvals=s,a)for(var l=t.canvas.getContext("2d"),p=[r,n,s],g=0;3>g;g++){for(var v=(g+1)*t.height/3,d=0,u=0;256>u;u++)p[g][u]>d&&(d=p[g][u]);var f=t.height/3/d,m=t.width/256;0==g?l.fillStyle="rgba(255,0,0,0.5)":1==g?l.fillStyle="rgba(0,255,0,0.5)":2==g&&(l.fillStyle="rgba(0,0,255,0.5)");for(var u=0;256>u;u++)l.fillRect(u*m,t.height-f*p[g][u]-t.height+v,m,p[g][u]*f)}return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}},Pixastic.Actions.crop={process:function(t){if(Pixastic.Client.hasCanvas()){var a=t.options.rect,e=a.width,i=a.height,r=a.top,n=a.left;"undefined"!=typeof t.options.left&&(n=parseInt(t.options.left,10)),"undefined"!=typeof t.options.top&&(r=parseInt(t.options.top,10)),"undefined"!=typeof t.options.height&&(e=parseInt(t.options.width,10)),"undefined"!=typeof t.options.height&&(i=parseInt(t.options.height,10)),0>n&&(n=0),n>t.width-1&&(n=t.width-1),0>r&&(r=0),r>t.height-1&&(r=t.height-1),1>e&&(e=1),n+e>t.width&&(e=t.width-n),1>i&&(i=1),r+i>t.height&&(i=t.height-r);var s=document.createElement("canvas");return s.width=t.width,s.height=t.height,s.getContext("2d").drawImage(t.canvas,0,0),t.canvas.width=e,t.canvas.height=i,t.canvas.getContext("2d").clearRect(0,0,e,i),t.canvas.getContext("2d").drawImage(s,n,r,e,i,0,0,e,i),t.useData=!1,!0}},checkSupport:function(){return Pixastic.Client.hasCanvas()}},Pixastic.Actions.desaturate={process:function(t){var a=!(!t.options.average||"false"==t.options.average);if(Pixastic.Client.hasCanvasImageData()){var e,i,r=Pixastic.prepareData(t),n=t.options.rect,s=n.width,o=n.height,c=s*o,h=4*c;if(a)for(;c--;)r[h-=4]=r[e=h+1]=r[i=h+2]=(r[h]+r[e]+r[i])/3;else for(;c--;)r[h-=4]=r[e=h+1]=r[i=h+2]=.3*r[h]+.59*r[e]+.11*r[i];return!0}return Pixastic.Client.isIE()?(t.image.style.filter+=" gray",!0):void 0},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()||Pixastic.Client.isIE()}},Pixastic.Actions.edges={process:function(t){var a=!(!t.options.mono||"false"==t.options.mono),e=!(!t.options.invert||"false"==t.options.invert);if(Pixastic.Client.hasCanvasImageData()){var i=Pixastic.prepareData(t),r=Pixastic.prepareData(t,!0),n=-1/8;weight=1/n;var s=t.options.rect,o=s.width,c=s.height,h=4*o,l=c;do{var p=(l-1)*h,g=l==c?l-1:l,v=1==l?0:l-2,d=v*o*4,u=g*o*4,f=o;do{var m=p+(4*f-4),x=d+4*(1==f?0:f-2),C=u+4*(f==o?f-1:f),w=((r[x-4]+r[x]+r[x+4]+r[m-4]+r[m+4]+r[C-4]+r[C]+r[C+4])*n+r[m])*weight,P=((r[x-3]+r[x+1]+r[x+5]+r[m-3]+r[m+5]+r[C-3]+r[C+1]+r[C+5])*n+r[m+1])*weight,I=((r[x-2]+r[x+2]+r[x+6]+r[m-2]+r[m+6]+r[C-2]+r[C+2]+r[C+6])*n+r[m+2])*weight;if(a){var D=.3*w+.59*P+.11*I||0;e&&(D=255-D),0>D&&(D=0),D>255&&(D=255),w=P=I=D}else e&&(w=255-w,P=255-P,I=255-I),0>w&&(w=0),0>P&&(P=0),0>I&&(I=0),w>255&&(w=255),P>255&&(P=255),I>255&&(I=255);i[m]=w,i[m+1]=P,i[m+2]=I}while(--f)}while(--l);return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}},Pixastic.Actions.edges2={process:function(t){if(Pixastic.Client.hasCanvasImageData()){for(var a=Pixastic.prepareData(t),e=Pixastic.prepareData(t,!0),i=t.options.rect,r=i.width,n=i.height,s=4*r,o=s+4,c=n-1,h=r-1,l=1;c>l;++l){for(var p=o-4,g=p-s,v=p+s,d=-e[g]-e[p]-e[v],u=-e[++g]-e[++p]-e[++v],f=-e[++g]-e[++p]-e[++v],m=e[g+=2],x=e[++g],C=e[++g],w=e[p+=2],P=e[++p],I=e[++p],D=e[v+=2],y=e[++v],M=e[++v],b=-m-w-D,_=-x-P-y,k=-C-I-M,A=1;h>A;++A){p=o+4,g=p-s,v=p+s;var E=127+d-m- -8*w-D,S=127+u-x- -8*P-y,F=127+f-C- -8*I-M;d=b,u=_,f=k,m=e[g],x=e[++g],C=e[++g],w=e[p],P=e[++p],I=e[++p],D=e[v],y=e[++v],M=e[++v],E+=b=-m-w-D,S+=_=-x-P-y,F+=k=-C-I-M,E>255&&(E=255),S>255&&(S=255),F>255&&(F=255),0>E&&(E=0),0>S&&(S=0),0>F&&(F=0),a[o]=E,a[++o]=S,a[++o]=F,o+=2}o+=8}return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}},Pixastic.Actions.emboss={process:function(t){var a=parseFloat(t.options.strength)||1,e="undefined"!=typeof t.options.greyLevel?parseInt(t.options.greyLevel):180,i=t.options.direction||"topleft",r=!(!t.options.blend||"false"==t.options.blend),n=0,s=0;switch(i){case"topleft":n=-1,s=-1;break;case"top":n=-1,s=0;break;case"topright":n=-1,s=1;break;case"right":n=0,s=1;break;case"bottomright":n=1,s=1;break;case"bottom":n=1,s=0;break;case"bottomleft":n=1,s=-1;break;case"left":n=0,s=-1}if(Pixastic.Client.hasCanvasImageData()){var o=Pixastic.prepareData(t),c=Pixastic.prepareData(t,!0),h=(!!t.options.invertAlpha,t.options.rect),l=h.width,p=h.height,g=4*l,v=p;do{var d=(v-1)*g,u=n;1>v+u&&(u=0),v+u>p&&(u=0);var f=(v-1+u)*l*4,m=l;do{var x=d+4*(m-1),C=s;1>m+C&&(C=0),m+C>l&&(C=0);var w=f+4*(m-1+C),P=c[x]-c[w],I=c[x+1]-c[w+1],D=c[x+2]-c[w+2],y=P,M=y>0?y:-y,b=I>0?I:-I,_=D>0?D:-D;if(b>M&&(y=I),_>M&&(y=D),y*=a,r){var k=o[x]+y,A=o[x+1]+y,E=o[x+2]+y;o[x]=k>255?255:0>k?0:k,o[x+1]=A>255?255:0>A?0:A,o[x+2]=E>255?255:0>E?0:E}else{var S=e-y;0>S?S=0:S>255&&(S=255),o[x]=o[x+1]=o[x+2]=S}}while(--m)}while(--v);return!0}return Pixastic.Client.isIE()?(t.image.style.filter+=" progid:DXImageTransform.Microsoft.emboss()",!0):void 0},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()||Pixastic.Client.isIE()}},Pixastic.Actions.flip={process:function(t){var a=t.options.rect,e=document.createElement("canvas");e.width=a.width,e.height=a.height,e.getContext("2d").drawImage(t.image,a.left,a.top,a.width,a.height,0,0,a.width,a.height);var i=t.canvas.getContext("2d");return i.clearRect(a.left,a.top,a.width,a.height),"horizontal"==t.options.axis?(i.scale(-1,1),i.drawImage(e,-a.left-a.width,a.top,a.width,a.height)):(i.scale(1,-1),i.drawImage(e,a.left,-a.top-a.height,a.width,a.height)),t.useData=!1,!0},checkSupport:function(){return Pixastic.Client.hasCanvas()}},Pixastic.Actions.fliph={process:function(t){if(Pixastic.Client.hasCanvas()){var a=t.options.rect,e=document.createElement("canvas");e.width=a.width,e.height=a.height,e.getContext("2d").drawImage(t.image,a.left,a.top,a.width,a.height,0,0,a.width,a.height);var i=t.canvas.getContext("2d");return i.clearRect(a.left,a.top,a.width,a.height),i.scale(-1,1),i.drawImage(e,-a.left-a.width,a.top,a.width,a.height),t.useData=!1,!0}return Pixastic.Client.isIE()?(t.image.style.filter+=" fliph",!0):void 0},checkSupport:function(){return Pixastic.Client.hasCanvas()||Pixastic.Client.isIE()}},Pixastic.Actions.flipv={process:function(t){if(Pixastic.Client.hasCanvas()){var a=t.options.rect,e=document.createElement("canvas");e.width=a.width,e.height=a.height,e.getContext("2d").drawImage(t.image,a.left,a.top,a.width,a.height,0,0,a.width,a.height);var i=t.canvas.getContext("2d");return i.clearRect(a.left,a.top,a.width,a.height),i.scale(1,-1),i.drawImage(e,a.left,-a.top-a.height,a.width,a.height),t.useData=!1,!0}return Pixastic.Client.isIE()?(t.image.style.filter+=" flipv",!0):void 0},checkSupport:function(){return Pixastic.Client.hasCanvas()||Pixastic.Client.isIE()}},Pixastic.Actions.glow={process:function(t){var a=parseFloat(t.options.amount)||0,e=parseFloat(t.options.radius)||0;if(a=Math.min(1,Math.max(0,a)),e=Math.min(5,Math.max(0,e)),Pixastic.Client.hasCanvasImageData()){var i=t.options.rect,r=document.createElement("canvas");r.width=t.width,r.height=t.height;var n=r.getContext("2d");n.drawImage(t.canvas,0,0);var s=2,o=Math.round(t.width/s),c=Math.round(t.height/s),h=document.createElement("canvas");h.width=o,h.height=c;for(var l=Math.round(20*e),p=h.getContext("2d"),g=0;l>g;g++){var v=Math.max(1,Math.round(o-g)),d=Math.max(1,Math.round(c-g));p.clearRect(0,0,o,c),p.drawImage(r,0,0,t.width,t.height,0,0,v,d),n.clearRect(0,0,t.width,t.height),n.drawImage(h,0,0,v,d,0,0,t.width,t.height)}for(var u=Pixastic.prepareData(t),f=Pixastic.prepareData({canvas:r,options:t.options}),m=i.width*i.height,x=4*m,C=x+1,w=x+2;m--;)(u[x-=4]+=a*f[x])>255&&(u[x]=255),(u[C-=4]+=a*f[C])>255&&(u[C]=255),(u[w-=4]+=a*f[w])>255&&(u[w]=255);return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}},Pixastic.Actions.histogram={process:function(t){var a=!(!t.options.average||"false"==t.options.average),e=!(!t.options.paint||"false"==t.options.paint),i=t.options.color||"rgba(255,255,255,0.5)",r=[];"object"!=typeof t.options.returnValue&&(t.options.returnValue={values:[]});var n=t.options.returnValue;if("array"!=typeof n.values&&(n.values=[]),r=n.values,Pixastic.Client.hasCanvasImageData()){var s=Pixastic.prepareData(t);t.useData=!1;for(var o=0;256>o;o++)r[o]=0;var c=t.options.rect,h=c.width*c.height,l=4*h,p=Math.round;if(a)for(;h--;)r[p((s[l-=4]+s[l+1]+s[l+2])/3)]++;else for(;h--;)r[p(.3*s[l-=4]+.59*s[l+1]+.11*s[l+2])]++;if(e){for(var g=0,o=0;256>o;o++)r[o]>g&&(g=r[o]);var v=t.height/g,d=t.width/256,u=t.canvas.getContext("2d");u.fillStyle=i;for(var o=0;256>o;o++)u.fillRect(o*d,t.height-v*r[o],d,r[o]*v)}return n.values=r,!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}},Pixastic.Actions.hsl={process:function(t){var a=parseInt(t.options.hue,10)||0,e=(parseInt(t.options.saturation,10)||0)/100,i=(parseInt(t.options.lightness,10)||0)/100;if(0>e)var r=1+e;else var r=1+2*e;a=a%360/360;var n=6*a,s=255*i,o=1+i,c=1-i;if(Pixastic.Client.hasCanvasImageData()){for(var h=Pixastic.prepareData(t),l=t.options.rect,p=l.width*l.height,g=4*p,v=g+1,d=g+2;p--;){var u=h[g-=4],f=h[v=g+1],m=h[d=g+2];if(0!=a||0!=e){var x=u;f>x&&(x=f),m>x&&(x=m);var C=u;C>f&&(C=f),C>m&&(C=m);var w=x-C,P=(C+x)/510;if(P>0&&w>0){if(.5>=P){var I=w/(x+C)*r;I>1&&(I=1);var D=P*(1+I)}else{var I=w/(510-x-C)*r;I>1&&(I=1);var D=P+I-P*I}if(u==x)if(f==C)var y=5+(x-m)/w+n;else var y=1-(x-f)/w+n;else if(f==x)if(m==C)var y=1+(x-u)/w+n;else var y=3-(x-m)/w+n;else if(u==C)var y=3+(x-f)/w+n;else var y=5-(x-u)/w+n;0>y&&(y+=6),y>=6&&(y-=6);var M=P+P-D,b=y>>0;0==b?(u=255*D,f=255*(M+(D-M)*(y-b)),m=255*M):1==b?(u=255*(D-(D-M)*(y-b)),f=255*D,m=255*M):2==b?(u=255*M,f=255*D,m=255*(M+(D-M)*(y-b))):3==b?(u=255*M,f=255*(D-(D-M)*(y-b)),m=255*D):4==b?(u=255*(M+(D-M)*(y-b)),f=255*M,m=255*D):5==b&&(u=255*D,f=255*M,m=255*(D-(D-M)*(y-b)))}}0>i?(u*=o,f*=o,m*=o):i>0&&(u=u*c+s,f=f*c+s,m=m*c+s),0>u?h[g]=0:u>255?h[g]=255:h[g]=u,0>f?h[v]=0:f>255?h[v]=255:h[v]=f,0>m?h[d]=0:m>255?h[d]=255:h[d]=m}return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}},Pixastic.Actions.invert={process:function(t){if(Pixastic.Client.hasCanvasImageData()){for(var a=Pixastic.prepareData(t),e=!!t.options.invertAlpha,i=t.options.rect,r=i.width*i.height,n=4*r,s=n+1,o=n+2,c=n+3;r--;)a[n-=4]=255-a[n],a[s-=4]=255-a[s],a[o-=4]=255-a[o],e&&(a[c-=4]=255-a[c]);return!0}return Pixastic.Client.isIE()?(t.image.style.filter+=" invert",!0):void 0},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()||Pixastic.Client.isIE()}},Pixastic.Actions.laplace={process:function(t){var a=!(!t.options.invert||"false"==t.options.invert),e=parseFloat(t.options.edgeStrength)||0,i=parseInt(t.options.greyLevel)||0;if(e=-e,Pixastic.Client.hasCanvasImageData()){var r=Pixastic.prepareData(t),n=Pixastic.prepareData(t,!0),s=1/8,o=t.options.rect,c=o.width,h=o.height,l=4*c,p=h;do{var g=(p-1)*l,v=p==h?p-1:p,d=1==p?0:p-2,u=d*c*4,f=v*c*4,m=c;do{var x=g+(4*m-4),C=u+4*(1==m?0:m-2),w=f+4*(m==c?m-1:m),P=(-n[C-4]-n[C]-n[C+4]-n[x-4]-n[x+4]-n[w-4]-n[w]-n[w+4]+8*n[x])*s,I=(-n[C-3]-n[C+1]-n[C+5]-n[x-3]-n[x+5]-n[w-3]-n[w+1]-n[w+5]+8*n[x+1])*s,D=(-n[C-2]-n[C+2]-n[C+6]-n[x-2]-n[x+6]-n[w-2]-n[w+2]-n[w+6]+8*n[x+2])*s,y=(P+I+D)/3+i;0!=e&&(y>127?y+=(y+1-128)*e:127>y&&(y-=(y+1)*e)),a&&(y=255-y),0>y&&(y=0),y>255&&(y=255),r[x]=r[x+1]=r[x+2]=y}while(--m)}while(--p);return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}},Pixastic.Actions.lighten={process:function(t){var a=parseFloat(t.options.amount)||0;if(a=Math.max(-1,Math.min(1,a)),Pixastic.Client.hasCanvasImageData()){for(var e=Pixastic.prepareData(t),i=t.options.rect,r=i.width*i.height,n=4*r,s=n+1,o=n+2,c=a+1;r--;)(e[n-=4]=e[n]*c)>255&&(e[n]=255),(e[s-=4]=e[s]*c)>255&&(e[s]=255),(e[o-=4]=e[o]*c)>255&&(e[o]=255);return!0}if(Pixastic.Client.isIE()){var h=t.image;return 0>a?(h.style.filter+=" light()",h.filters[h.filters.length-1].addAmbient(255,255,255,100*-a)):a>0&&(h.style.filter+=" light()",h.filters[h.filters.length-1].addAmbient(255,255,255,100),h.filters[h.filters.length-1].addAmbient(255,255,255,100*a)),!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()||Pixastic.Client.isIE()}},Pixastic.Actions.mosaic={process:function(t){var a=Math.max(1,parseInt(t.options.blockSize,10));if(Pixastic.Client.hasCanvasImageData()){var e=t.options.rect,i=e.width,r=e.height,n=r,s=t.canvas.getContext("2d"),o=document.createElement("canvas");o.width=o.height=1;var c=o.getContext("2d"),h=document.createElement("canvas");h.width=i,h.height=r;var l=h.getContext("2d");l.drawImage(t.canvas,e.left,e.top,i,r,0,0,i,r);for(var n=0;r>n;n+=a)for(var p=0;i>p;p+=a){var g=a,v=a;g+p>i&&(g=i-p),v+n>r&&(v=r-n),c.drawImage(h,p,n,g,v,0,0,1,1);var d=c.getImageData(0,0,1,1).data;s.fillStyle="rgb("+d[0]+","+d[1]+","+d[2]+")",s.fillRect(e.left+p,e.top+n,a,a)}return t.useData=!1,!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}},Pixastic.Actions.noise={process:function(t){var a=0,e=0,i=!1;"undefined"!=typeof t.options.amount&&(a=parseFloat(t.options.amount)||0),"undefined"!=typeof t.options.strength&&(e=parseFloat(t.options.strength)||0),"undefined"!=typeof t.options.mono&&(i=!(!t.options.mono||"false"==t.options.mono)),a=Math.max(0,Math.min(1,a)),e=Math.max(0,Math.min(1,e));var r=128*e,n=r/2;if(Pixastic.Client.hasCanvasImageData()){var s=Pixastic.prepareData(t),o=t.options.rect,c=o.width,h=o.height,l=4*c,p=h,g=Math.random;do{var v=(p-1)*l,d=c;do{var u=v+4*(d-1);if(g()<a){if(i)var f=-n+g()*r,m=s[u]+f,x=s[u+1]+f,C=s[u+2]+f;else var m=s[u]-n+g()*r,x=s[u+1]-n+g()*r,C=s[u+2]-n+g()*r;0>m&&(m=0),0>x&&(x=0),0>C&&(C=0),m>255&&(m=255),x>255&&(x=255),C>255&&(C=255),s[u]=m,s[u+1]=x,s[u+2]=C}}while(--d)}while(--p);return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}},Pixastic.Actions.posterize={process:function(t){var a=256;if("undefined"!=typeof t.options.levels&&(a=parseInt(t.options.levels,10)||1),Pixastic.Client.hasCanvasImageData()){var e=Pixastic.prepareData(t);a=Math.max(2,Math.min(256,a));var i=256/a,r=256/(a-1),n=t.options.rect,s=n.width,o=n.height,c=4*s,h=o;do{var l=(h-1)*c,p=s;do{var g=l+4*(p-1),v=r*(e[g]/i>>0),d=r*(e[g+1]/i>>0),u=r*(e[g+2]/i>>0);v>255&&(v=255),d>255&&(d=255),u>255&&(u=255),e[g]=v,e[g+1]=d,e[g+2]=u}while(--p)}while(--h);return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}},Pixastic.Actions.pointillize={process:function(t){var a=Math.max(1,parseInt(t.options.radius,10)),e=Math.min(5,Math.max(0,parseFloat(t.options.density)||0)),i=Math.max(0,parseFloat(t.options.noise)||0),r=!(!t.options.transparent||"false"==t.options.transparent);if(Pixastic.Client.hasCanvasImageData()){var n=t.options.rect,s=n.width,o=n.height,c=o,h=t.canvas.getContext("2d"),l=t.canvas.width,p=t.canvas.height,g=document.createElement("canvas");g.width=g.height=1;var v=g.getContext("2d"),d=document.createElement("canvas");d.width=s,d.height=o;var u=d.getContext("2d");u.drawImage(t.canvas,n.left,n.top,s,o,0,0,s,o);var f=2*a;r&&h.clearRect(n.left,n.top,n.width,n.height);for(var m=a*i,x=1/e,c=0;o+a>c;c+=f*x)for(var C=0;s+a>C;C+=f*x){rndX=i?C+(2*Math.random()-1)*m>>0:C,rndY=i?c+(2*Math.random()-1)*m>>0:c;var w=rndX-a,P=rndY-a;0>w&&(w=0),0>P&&(P=0);var I=rndX+n.left,D=rndY+n.top;0>I&&(I=0),I>l&&(I=l),0>D&&(D=0),D>p&&(D=p);var y=f,M=f;y+w>s&&(y=s-w),M+P>o&&(M=o-P),1>y&&(y=1),1>M&&(M=1),v.drawImage(d,w,P,y,M,0,0,1,1);var b=v.getImageData(0,0,1,1).data;h.fillStyle="rgb("+b[0]+","+b[1]+","+b[2]+")",h.beginPath(),h.arc(I,D,a,0,2*Math.PI,!0),h.closePath(),h.fill()}return t.useData=!1,!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}},Pixastic.Actions.removenoise={process:function(t){if(Pixastic.Client.hasCanvasImageData()){var a=Pixastic.prepareData(t),e=t.options.rect,i=e.width,r=e.height,n=4*i,s=r;do{var o=(s-1)*n,c=s==r?s-1:s,h=1==s?0:s-2,l=h*i*4,p=c*i*4,g=i;do{var v,d,u,f,m,x,C=o+(4*g-4),w=l+4*(1==g?0:g-2),P=p+4*(g==i?g-1:g);v=d=a[w];var I=a[C-4],D=a[C+4],y=a[P];v>I&&(v=I),v>D&&(v=D),v>y&&(v=y),I>d&&(d=I),D>d&&(d=D),y>d&&(d=y),u=f=a[w+1];var M=a[C-3],b=a[C+5],_=a[P+1];u>M&&(u=M),u>b&&(u=b),u>_&&(u=_),M>f&&(f=M),b>f&&(f=b),_>f&&(f=_),m=x=a[w+2];var k=a[C-2],A=a[C+6],E=a[P+2];m>k&&(m=k),m>A&&(m=A),m>E&&(m=E),k>x&&(x=k),A>x&&(x=A),E>x&&(x=E),a[C]>d?a[C]=d:a[C]<v&&(a[C]=v),a[C+1]>f?a[C+1]=f:a[C+1]<u&&(a[C+1]=u),a[C+2]>x?a[C+2]=x:a[C+2]<m&&(a[C+2]=m)}while(--g)}while(--s);return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}},Pixastic.Actions.resize={process:function(t){if(Pixastic.Client.hasCanvas()){var a=parseInt(t.options.width,10),e=parseInt(t.options.height,10),i=t.canvas;
1>a&&(a=1),2>a&&(a=2);var r=document.createElement("canvas");return r.width=a,r.height=e,r.getContext("2d").drawImage(i,0,0,a,e),i.width=a,i.height=e,i.getContext("2d").drawImage(r,0,0),t.useData=!1,!0}},checkSupport:function(){return Pixastic.Client.hasCanvas()}},Pixastic.Actions.rotate={process:function(t){if(Pixastic.Client.hasCanvas()){var a=t.canvas,e=t.width,i=t.height,r=document.createElement("canvas");r.width=e,r.height=i,r.getContext("2d").drawImage(a,0,0,e,i);var n=-parseFloat(t.options.angle)*Math.PI/180,s=n;s>.5*Math.PI&&(s=Math.PI-s),s<.5*-Math.PI&&(s=-Math.PI-s);var o=Math.sqrt(e*e+i*i),c=Math.abs(s)-Math.abs(Math.atan2(i,e)),h=Math.abs(s)+Math.abs(Math.atan2(i,e)),l=Math.abs(Math.cos(c)*o),p=Math.abs(Math.sin(h)*o);a.width=l,a.height=p;var g=a.getContext("2d");return g.translate(l/2,p/2),g.rotate(n),g.drawImage(r,-e/2,-i/2),t.useData=!1,!0}},checkSupport:function(){return Pixastic.Client.hasCanvas()}},Pixastic.Actions.sepia={process:function(t){var a=parseInt(t.options.mode,10)||0;if(0>a&&(a=0),a>1&&(a=1),Pixastic.Client.hasCanvasImageData()){var e=Pixastic.prepareData(t),i=t.options.rect,r=i.width,n=i.height,s=4*r,o=n;do{var c=(o-1)*s,h=r;do{var l=c+4*(h-1);if(a)var p=.299*e[l]+.587*e[l+1]+.114*e[l+2],g=p+39,v=p+14,d=p-36;else var u=e[l],f=e[l+1],m=e[l+2],g=.393*u+.769*f+.189*m,v=.349*u+.686*f+.168*m,d=.272*u+.534*f+.131*m;0>g&&(g=0),g>255&&(g=255),0>v&&(v=0),v>255&&(v=255),0>d&&(d=0),d>255&&(d=255),e[l]=g,e[l+1]=v,e[l+2]=d}while(--h)}while(--o);return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}},Pixastic.Actions.sharpen={process:function(t){var a=0;if("undefined"!=typeof t.options.amount&&(a=parseFloat(t.options.amount)||0),0>a&&(a=0),a>1&&(a=1),Pixastic.Client.hasCanvasImageData()){for(var e=Pixastic.prepareData(t),i=Pixastic.prepareData(t,!0),r=15,n=1+3*a,s=[[0,-n,0],[-n,r,-n],[0,-n,0]],o=0,c=0;3>c;c++)for(var h=0;3>h;h++)o+=s[c][h];o=1/o;var l=t.options.rect,p=l.width,g=l.height;r*=o,n*=o;var v=4*p,d=g;do{var u=(d-1)*v,f=d==g?d-1:d,m=1==d?0:d-2,x=m*v,C=f*v,w=p;do{var P=u+(4*w-4),I=x+4*(1==w?0:w-2),D=C+4*(w==p?w-1:w),y=(-i[I]-i[P-4]-i[P+4]-i[D])*n+i[P]*r,M=(-i[I+1]-i[P-3]-i[P+5]-i[D+1])*n+i[P+1]*r,b=(-i[I+2]-i[P-2]-i[P+6]-i[D+2])*n+i[P+2]*r;0>y&&(y=0),0>M&&(M=0),0>b&&(b=0),y>255&&(y=255),M>255&&(M=255),b>255&&(b=255),e[P]=y,e[P+1]=M,e[P+2]=b}while(--w)}while(--d);return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}},Pixastic.Actions.solarize={process:function(t){!(!t.options.average||"false"==t.options.average);if(Pixastic.Client.hasCanvasImageData()){var a=Pixastic.prepareData(t),e=t.options.rect,i=e.width,r=e.height,n=4*i,s=r;do{var o=(s-1)*n,c=i;do{var h=o+4*(c-1),l=a[h],p=a[h+1],g=a[h+2];l>127&&(l=255-l),p>127&&(p=255-p),g>127&&(g=255-g),a[h]=l,a[h+1]=p,a[h+2]=g}while(--c)}while(--s);return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}},Pixastic.Actions.unsharpmask={process:function(t){var a=parseFloat(t.options.amount)||0,e=parseFloat(t.options.radius)||0,i=parseFloat(t.options.threshold)||0;a=Math.min(500,Math.max(0,a))/2,e=Math.min(5,Math.max(0,e))/10,i=Math.min(255,Math.max(0,i)),i--;var r=-i;if(a*=.016,a++,Pixastic.Client.hasCanvasImageData()){var n=t.options.rect,s=document.createElement("canvas");s.width=t.width,s.height=t.height;var o=s.getContext("2d");o.drawImage(t.canvas,0,0);var c=2,h=Math.round(t.width/c),l=Math.round(t.height/c),p=document.createElement("canvas");p.width=h,p.height=l;for(var g=Math.round(20*e),v=p.getContext("2d"),d=0;g>d;d++){var u=Math.max(1,Math.round(h-d)),f=Math.max(1,Math.round(l-d));v.clearRect(0,0,h,l),v.drawImage(s,0,0,t.width,t.height,0,0,u,f),o.clearRect(0,0,t.width,t.height),o.drawImage(p,0,0,u,f,0,0,t.width,t.height)}var m=Pixastic.prepareData(t),x=Pixastic.prepareData({canvas:s,options:t.options}),C=n.width,w=n.height,P=4*C,I=w;do{var D=(I-1)*P,y=C;do{var M=D+(4*y-4),b=m[M]-x[M];if(b>i||r>b){var _=x[M];_=a*b+_,m[M]=_>255?255:0>_?0:_}var k=m[M+1]-x[M+1];if(k>i||r>k){var A=x[M+1];A=a*k+A,m[M+1]=A>255?255:0>A?0:A}var E=m[M+2]-x[M+2];if(E>i||r>E){var S=x[M+2];S=a*E+S,m[M+2]=S>255?255:0>S?0:S}}while(--y)}while(--I);return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};